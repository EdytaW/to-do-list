'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

exports.default = function () {
    var logger = arguments.length <= 0 || arguments[0] === undefined ? console.log.bind(console) : arguments[0];

    return function () {
        logger({ type: 'global-start' });

        for (var _len = arguments.length, tasks = Array(_len), _key = 0; _key < _len; _key++) {
            tasks[_key] = arguments[_key];
        }

        return tasks.reduce(function (current, next) {
            return current.then(function () {
                return new _promise2.default(function (resolve, reject) {
                    logger({ name: next.name, type: 'task-start' });

                    return next(function (messages) {
                        logger({ name: next.name, messages: messages, type: 'task-resolve' });
                        resolve();
                    }, function (messages) {
                        logger({ name: next.name, messages: messages, type: 'task-reject' });
                        reject();
                    });
                });
            });
        }, _promise2.default.resolve()).then(function () {
            logger({ type: 'global-resolve' });
        }).catch(function (error) {
            logger({ type: 'global-reject' });

            // don't mute hard errors
            if (error instanceof Error) {
                console.error(error.stack);
            }

            throw new Error(error);
        });
    };
};

var _promise = require('babel-runtime/core-js/promise');

var _promise2 = _interopRequireDefault(_promise);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

module.exports = exports['default'];